<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="resource-type" content="document" />
    <meta http-equiv="content-type" content="text/html; charset=US-ASCII" />
    <meta http-equiv="content-language" content="en-us" />
    <meta name="author" content="Tyler A. Green">
    <meta name="contact" content="greent@tyleragreen.com" />
    <meta name="copyright" content="Copyright (c)2016 Tyler A. Green. All Rights Reserved." />
    <meta name="description" content="Personal website and blog for public transit enthusiast Tyler A. Green." />
    <meta name="keywords" content="tyler a green, transit, public transit, transportation, cities, urban, buses, subways, light rail, blog, colorado" />
    <link rel="icon" href="../favicon.ico">

    <title>New York City Transit Frequency Visualization</title>

  <!-- Mapbox Includes -->
  <script src='https://api.tiles.mapbox.com/mapbox.js/v2.2.4/mapbox.js'></script>
  <link href='https://api.tiles.mapbox.com/mapbox.js/v2.2.4/mapbox.css' rel='stylesheet' />

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Oswald" rel="stylesheet" type="text/css">
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700' rel='stylesheet' type='text/css'>

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Lato', sans-serif;
    }
    .map {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 100%;
    }

    /* LOADER */
    #loader {
        position :absolute;
        top: 0;
        bottom: 0;
        width: 100%;
        background-image: url('IMG_2903(3).jpg');
        background-size: cover;
        transition: background 1s ease-out;
        -webkit-transition: background 1s ease-out;
        -moz-transition: background 1s ease-out;
        -o-transition: background 1s ease-out;
        text-align: center;
    }
    #loader.done {
        background: rgba(255, 255, 255, 0);
    }
    #loader.hide {
        display: none;
    }
    #loader .message {
        width: 100%;
        position: absolute;
        bottom: 50px;
    }
    #loader h1 {
        font-family: 'Oswald', sans-serif;
        font-size: 100px;
        color: white;
        text-transform: uppercase;
        text-shadow: 0 4px 4px rgba(0,0,0,0.8);
    }
    /* End LOADER */

    /* MAP TOGGLES */
    .menu-ui {
      background: #fff;
      position: absolute;
      top: 15px;
      right: 15px;
      z-index:1;
      border-radius: 3px;
      width: 160px;
      border: 1px solid rgba(0,0,0,0.4);
      }
      .menu-ui a {
        font-size: 16px;
        color: #404040;
        display: block;
        margin: 0;
        padding: 13px;
        text-decoration: none;
        border-bottom: 1px solid rgba(0,0,0,0.25);
        text-align: center;
        }
        .menu-ui a:first-child {
          border-radius: 3px 3px 0 0;
          }
        .menu-ui a:last-child {
          border: none;
          border-radius: 0 0 3px 3px;
          }
        .menu-ui a:hover {
          background: #f8f8f8;
          color: #404040;
          }
        .menu-ui a.active {
          background: #3887BE;
          color: #FFF;
          }
          .menu-ui a.active:hover {
            background: #3074a4;
            }
    /* End MAP TOGGLES */

    /* LEGEND */
    .legend label,
    .legend span {
      display: block;
      float: left;
      height: 15px;
      width: 20%;
      text-align: center;
      font-size: 9px;
      color: #808080;
     }
    /* End MAP LEGEND */
  </style>
</head>
<body>
<div id='map-one' class='map'></div>
<nav id='menu-ui' class='menu-ui'></nav>
<div id='loader'><div class='message'><h1>Loading...</h1></div></div>

<!-- Set the display of this container to none so we can add it programmatically to `legendControl` -->
<div id='legend' style='display:none;'>
  <strong>Transit Trips / Hour</strong><br />
  <nav class='legend clearfix'>
    <span style='background:#ffffff;'></span>
    <span style='background:#fdcc8a;'></span>
    <span style='background:#fc8d59;'></span>
    <span style='background:#d7301f;'></span>
    <span style='background:#ffffff;'></span>
    <label></label>
    <label>&lt; 9</label>
    <label>9 - 12</label>
    <label>&gt; 12</label>
    <label></label>
    <small>Created by <a href="http://www.tyleragreen.com/">Tyler A. Green</a> using <a href="https://transit.land/" target="_blank">Transitland</a> and <a href="https://www.mapbox.com/" target="_blank">Mapbox</a>. View <a href="https://github.com/tyleragreen/nyc-frequency-visualization/tree/live_map" target="_blank">the code</a> and explanation.</small>
</div>

<script>
var latitude   = 40.72;
var longitude  = -74.0;
var zoom_level = 11;

var loader = document.getElementById('loader');
var layers = document.getElementById('menu-ui');

L.mapbox.accessToken = 'pk.eyJ1IjoiZ3JlZW50IiwiYSI6ImNpazBqdWFsOTM5Nnh2M2x6dWZ2dnB3aHkifQ.97-pFPD8lQf02B6edag1rA';

var map = L.mapbox.map('map-one', 'mapbox.streets')
  .setView([latitude, longitude], zoom_level);
map.legendControl.addLegend(document.getElementById('legend').innerHTML);

addLayer(L.mapbox.featureLayer(),true,'Bus - Friday',1,'output_2016-01-22_07-30-00_08-00-00_bus.geojson');
addLayer(L.mapbox.featureLayer(),false,'Subway - Friday',2,'output_2016-01-22_07-30-00_08-00-00_subway.geojson');
addLayer(L.mapbox.featureLayer(),false,'Bus - Saturday',3,'output_2016-01-23_07-30-00_08-00-00_bus.geojson');
addLayer(L.mapbox.featureLayer(),false,'Subway - Saturday',4,'output_2016-01-23_07-30-00_08-00-00_subway.geojson');

function startLoading() {
  loader.className = '';
}

function finishedLoading() {
  loader.className = 'hide';
}

function addLayer(layer, active, name, zIndex, url) {
  layer.setZIndex(zIndex)
    .addTo(map);

  var link = document.createElement('a');
  link.href      = '#';
  link.className = 'active';
  link.innerHTML = name;

  if (active) {
    startLoading();
    layer.loadURL(url)
      .on('ready', finishedLoading);
    map.addLayer(layer);
    link.className = 'active';
  } else {
    layer.loadURL(url);
    map.removeLayer(layer);
    link.className = '';
  }


  link.onclick = function(e) {
    e.preventDefault();
    e.stopPropagation();

    if (map.hasLayer(layer)) {
      map.removeLayer(layer);
      this.className = '';
    } else {
      map.addLayer(layer)
      this.className = 'active';
    }
  };
  layer.on('mouseover', function(e) {
    e.layer.openPopup();
  });
  layer.on('mouseout', function(e) {
    e.layer.closePopup();
  });

  layers.appendChild(link);
}
</script>
</body>
</html>
