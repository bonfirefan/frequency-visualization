<!DOCTYPE html>
<html>
<head>
  <meta charset=utf-8 />
  <title>New York City Transit Frequency Visualization</title>
  <script src='https://api.tiles.mapbox.com/mapbox.js/v2.2.4/mapbox.js'></script>
  <link href='https://api.tiles.mapbox.com/mapbox.js/v2.2.4/mapbox.css' rel='stylesheet' />
  <link href="https://fonts.googleapis.com/css?family=Oswald" rel="stylesheet" type="text/css">
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700' rel='stylesheet' type='text/css'>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Lato', sans-serif;
    }
    .map {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 100%;
    }
    #loader {
        position :absolute;
        top: 0;
        bottom: 0;
        width: 100%;
        background-image: url('IMG_2903(3).jpg');
        background-size: cover;
        transition: background 1s ease-out;
        -webkit-transition: background 1s ease-out;
        -moz-transition: background 1s ease-out;
        -o-transition: background 1s ease-out;
        text-align: center;
    }
    #loader.done {
        background: rgba(255, 255, 255, 0);
    }
    #loader.hide {
        display: none;
    }
    #loader .message {
        width: 100%;
        position: absolute;
        bottom: 50px;
    }
    #loader h1 {
        font-family: 'Oswald', sans-serif;
        font-size: 100px;
        color: white;
        text-transform: uppercase;
        text-shadow: 0 4px 4px rgba(0,0,0,0.8);
    }
    .menu-ui {
      background: #fff;
      position: absolute;
      top: 15px;
      right: 15px;
      z-index:1;
      border-radius: 3px;
      width: 160px;
      border: 1px solid rgba(0,0,0,0.4);
      }
      .menu-ui a {
        font-size: 16px;
        color: #404040;
        display: block;
        margin: 0;
        padding: 13px;
        text-decoration: none;
        border-bottom: 1px solid rgba(0,0,0,0.25);
        text-align: center;
        }
        .menu-ui a:first-child {
          border-radius: 3px 3px 0 0;
          }
        .menu-ui a:last-child {
          border: none;
          border-radius: 0 0 3px 3px;
          }
        .menu-ui a:hover {
          background: #f8f8f8;
          color: #404040;
          }
        .menu-ui a.active {
          background: #3887BE;
          color: #FFF;
          }
          .menu-ui a.active:hover {
            background: #3074a4;
            }
  </style>
</head>
<body>
<div id='map-one' class='map'></div>
<nav id='menu-ui' class='menu-ui'></nav>
<div id='loader'><div class='message'><h1>Loading...</h1></div></div>
<script>
var latitude   = 40.72;
var longitude  = -74.0;
var zoom_level = 11;

var loader = document.getElementById('loader');
var layers = document.getElementById('menu-ui');

L.mapbox.accessToken = 'pk.eyJ1IjoiZ3JlZW50IiwiYSI6ImNpazBqdWFsOTM5Nnh2M2x6dWZ2dnB3aHkifQ.97-pFPD8lQf02B6edag1rA';
var map = L.mapbox.map('map-one', 'mapbox.streets')
  .setView([latitude, longitude], zoom_level);

//var featureLayer = L.mapbox.featureLayer()
//  .addTo(map);
//startLoading();
//featureLayer.loadURL('output_2016-01-22_07-30-00_08-00-00_bus.geojson')
//  .on('ready', finishedLoading);

addLayer(L.mapbox.featureLayer(),true,'Bus - Friday',1,'output_2016-01-22_07-30-00_08-00-00_bus.geojson');
addLayer(L.mapbox.featureLayer(),false,'Subway - Friday',2,'output_2016-01-22_07-30-00_08-00-00_subway.geojson');
addLayer(L.mapbox.featureLayer(),false,'Bus - Saturday',3,'output_2016-01-23_07-30-00_08-00-00_bus.geojson');
addLayer(L.mapbox.featureLayer(),false,'Subway - Saturday',4,'output_2016-01-23_07-30-00_08-00-00_subway.geojson');

function startLoading() {
  loader.className = '';
}

function finishedLoading() {
  loader.className = 'hide';
}

function addLayer(layer, active, name, zIndex, url) {
  layer.setZIndex(zIndex)
    .addTo(map);

  var link = document.createElement('a');
  link.href      = '#';
  link.className = 'active';
  link.innerHTML = name;

  if (active) {
    startLoading();
    layer.loadURL(url)
      .on('ready', finishedLoading);
    map.addLayer(layer);
    link.className = 'active';
  } else {
    layer.loadURL(url);
    map.removeLayer(layer);
    link.className = '';
  }


  link.onclick = function(e) {
    e.preventDefault();
    e.stopPropagation();

    if (map.hasLayer(layer)) {
      map.removeLayer(layer);
      this.className = '';
    } else {
      map.addLayer(layer)
      this.className = 'active';
    }
  };
  layer.on('mouseover', function(e) {
    e.layer.openPopup();
  });
  layer.on('mouseout', function(e) {
    e.layer.closePopup();
  });

  layers.appendChild(link);
}
</script>
</body>
</html>
